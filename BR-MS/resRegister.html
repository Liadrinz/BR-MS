<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新物料入库</title>
    <link rel="stylesheet" href="lib/eleme-index.css">
    <style>

        #box2 .el-collapse-item__header {
            font-size: 18px;
            font-weight: bolder;
        }

        #box2 .header {
            border-bottom: 1px solid #dcdfe6;
            margin: 50px 0;
            margin-left: 100px;
            width: 80%;
        }

        #box2 .header > span {
            font-size: 20px;
            display: block;
            margin-bottom: 20px;
        }

        #box2 .el-form-item > * {
            width: 50%;
        }

        #box2 .el-select, .el-cascader {
            width: 100%;
        }

        @media (max-width: 1000px) {
            #box2 .el-aside {
                display: none;
            }
        }

        #box2 .el-header {
            display: none;
        }

        #box2 .adel {
            display: inline-block;
            position: relative;
            left: 60%;
        }

        #box2 .sub-form {
            margin-left: 50px;
        }

        #box2 .el-container {
            overflow: hidden;
        }

        #box2 a {
            color: black;
            text-decoration: none;
        }

        #box2 el-main {
            overflow: fragments;
        }

        #box2 .menu > a > div {
            padding: 10px;
            border-bottom: 1px solid rgba(192, 192, 192, 0.5);
            transition: background 0.5s;
        }

        #box2 .menu > a > div:hover {
            background: rgba(168, 168, 168, 0.4);
        }

        [v-cloak] {
            display: none;
        }

        /*element自带表格对不齐,网上找的好看的表格样式*/

        .grid {
            font-family: verdana, arial, sans-serif;
            font-size: 11px;
            color: #333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
        }

        .grid th {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #ffffff;
        }

        .grid td {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #ffffff;
        }

        .grid, #form-top {
            display: block;
        }

        #form-top {
            font-size: 6px;
        }

        #form-top span {
            display: inline-block;
            margin: 0 1%;
        }

        .noprint{
            text-align: left;
        }

        @media print{
            .noprint{
                display: none;
            }
        }
    </style>
</head>
<body>
<div id="app" v-cloak>
    <div v-if="state===1" id="box1">
        <div id="above">
            <el-form id="above-form" ref="headerForm">
                <el-form :inline="true" :rules="headerRules.rules1" ref="upperForm" :model="importInfo"
                         label-width="200px">
                    <el-form-item label="入库单号" prop="inboundNum" required>
                        <el-input v-model="importInfo.inboundNum" size="medium" :disabled="true"></el-input>
                    </el-form-item>
                    <el-form-item label="建单人" prop="founder" required>
                        <el-input v-model="importInfo.founder" size="medium"></el-input>
                    </el-form-item>
                    <el-form-item label="入库单上传" style="display: none">
                        <el-upload action="#">
                            <el-button type="primary" size="medium">点击上传</el-button>
                        </el-upload>
                    </el-form-item>
                </el-form>
                <el-form :inline="true" :rules="headerRules.rules3" ref="downForm" :model="importInfo"
                         label-width="200px">
                    <el-form-item label="供应商" prop="supplier" required>
                        <el-input size="medium" v-model="importInfo.supplier"></el-input>
                    </el-form-item>
                    <el-form-item label="入库类别" prop="type" required>
                        <el-select size="medium" v-model="importInfo.type">
                            <el-option label="正常入库" :value="1">正常入库</el-option>
                            <el-option label="非正常入库" :value="0">非正常入库</el-option>
                        </el-select>
                    </el-form-item>
                </el-form>
            </el-form>
        </div>
        <div id="below">
            <el-table :data="resInfo" ref="multipleTable" tooltip-effect="dark" stripe>
                <el-table-column type="index" :index="indexMethod" label="序号" :width="75"></el-table-column>
                <el-table-column label="货品信息" :width="125">
                    <template slot-scope="props">
                        <el-button v-if="!props.row.canView" size="mini" type="primary"
                                   @click="()=>{createRes(resInfo.indexOf(props.row));}">填写
                        </el-button>
                        <el-button v-if="props.row.canView" size="mini" type="success"
                                   @click="()=>{viewResDetail(resInfo.indexOf(props.row));}">查看
                        </el-button>
                    </template>
                </el-table-column>
                <el-table-column label="数量" prop="amount" :width="100"></el-table-column>
                <el-table-column label="单位" prop="unit" :width="100"></el-table-column>
                <!--未定变量名-->
                <el-table-column label="存放库位" prop="warehouseRepository" :width="120"></el-table-column>
                <el-table-column label="责任人" prop="charity" :width="150"></el-table-column>
                <el-table-column label="联系电话" prop="phone" :width="175"></el-table-column>
                <el-table-column label="备注" prop="remark" :width="150"></el-table-column>
                <el-table-column label="操作" :width="200">
                    <template slot-scope="props">
                        <el-button size="mini" type="primary" @click="()=>{handleEdit(props.$index,resInfo)}">编辑
                        </el-button>
                        <el-button size="mini" type="danger" @click="()=>{performDelete(props.$index,resInfo)}">删除
                        </el-button>
                        <el-dialog :visible.sync="editFormVisible" title="货品简单信息" width="600px">

                            <el-form ref="dialogEditForm" :model="singleResEditInfo" :rules="smallFormRule"
                                     label-width="120px" label-position="left">
                                <el-form-item prop="amount" label="数量" required>
                                    <el-input v-model="singleResEditInfo.amount" placeholder="请输入货品的数量"></el-input>
                                </el-form-item>
                                <el-form-item prop="unit" label="单位" required>
                                    <el-input v-model="singleResEditInfo.unit" placeholder="请输入货品数量的单位"></el-input>
                                </el-form-item>

                                <el-form-item prop="warehouseRepository" label="存放库位">
                                    <el-input v-model="singleResEditInfo.warehouseRepository"
                                              placeholder="请输入货品存放的库位"></el-input>
                                </el-form-item>

                                <el-form-item prop="charity" label="责任人" required>
                                    <el-input v-model="singleResEditInfo.charity" placeholder="请输入货品负责人的姓名"></el-input>
                                </el-form-item>
                                <el-form-item prop="phone" label="联系电话" required>
                                    <el-input v-model="singleResEditInfo.phone" placeholder="请输入货品负责人的联系电话"></el-input>
                                </el-form-item>
                                <el-form-item prop="remark" label="备注" required>
                                    <el-input v-model="singleResEditInfo.remark" placeholder="请输入备注"></el-input>
                                </el-form-item>
                                <p style="text-align: right">
                                    <el-button type="primary" @click="()=>{performEdit(props.row)}">修改</el-button>
                                    <el-button @click="editFormVisible=false">取消</el-button>
                                </p>
                            </el-form>
                        </el-dialog>
                    </template>
                </el-table-column>
            </el-table>
            <p style="text-align: center">
                <el-button size="medium" type="primary" @click="handleAdd">+ 添加货品</el-button>
            </p>
            <el-dialog :visible.sync="addFormVisible" title="货品简单信息" width="600px">

                <el-form :rules="smallFormRule" ref="dialogAddForm" :model="singleResAddInfo" label-width="120px"
                         label-position="left">
                    <el-form-item prop="amount" label="数量" required>
                        <el-input v-model="singleResAddInfo.amount" placeholder="请输入货品的数量"></el-input>
                    </el-form-item>
                    <el-form-item prop="unit" label="单位" required>
                        <el-input v-model="singleResAddInfo.unit" placeholder="请输入货品数量的单位"></el-input>
                    </el-form-item>

                    <el-form-item prop="warehouseRepository" label="存放库位" required>
                        <el-input v-model="singleResAddInfo.warehouseRepository" placeholder="请输入货品存放的库位"></el-input>
                    </el-form-item>

                    <el-form-item prop="charity" label="责任人" required>
                        <el-input v-model="singleResAddInfo.charity" placeholder="请输入货品负责人的姓名"></el-input>
                    </el-form-item>
                    <el-form-item prop="phone" label="联系电话" required>
                        <el-input v-model="singleResAddInfo.phone" placeholder="请输入货品负责人的联系电话"></el-input>
                    </el-form-item>
                    <el-form-item prop="remark" label="备注" required>
                        <el-input v-model="singleResAddInfo.remark" placeholder="请输入备注"></el-input>
                    </el-form-item>
                    <p style="text-align: right">
                        <el-button type="primary" @click="performAdd">添加</el-button>
                        <el-button @click="addFormVisible=false">取消</el-button>
                    </p>
                </el-form>
            </el-dialog>
            <el-dialog :visible.sync="detailDialogVisible" title="货品详细信息" width="600px">
                <el-table :data="detailToDisplay">
                    <el-table-column prop="key"></el-table-column>
                    <el-table-column prop="val"></el-table-column>
                </el-table>
            </el-dialog>
        </div>
        <p style="text-align: right">
            <el-button type="primary" @click="save">保存</el-button>
            <el-button @click="print">生成货品清单</el-button>
        </p>
    </div>
    <!-------------------------------------------------------------------------------------------------------------------------------------------------------->
    <div v-if="state===2" id="box2">
        <el-container>
            <el-container style="padding-top:25px;">
                <el-aside style="width: 250px;">
                    <div style="margin:0;position:fixed;width:225px;">
                        <div class="header" style="margin:0;border:none;">
                            <span style="margin:0 5px 5px 5px;padding-top:0;">物资信息</span>
                        </div>
                        <div class="menu">
                            <a href="#Attr">
                                <div style="border-top:1px solid rgba(192,192,192,0.5); margin-top: 10px">属性</div>
                            </a>
                            <a href="#Pos">
                                <div>位置</div>
                            </a>
                            <a href="#State">
                                <div>状态</div>
                            </a>
                            <a href="#Cap">
                                <div>能力</div>
                            </a>
                        </div>
                    </div>
                </el-aside>
                <el-main>
                    <el-collapse id="collapse-container" v-model="activeNames" @change="handleCollapse"
                                 style="margin-top: 45px">
                        <div id="Attr" class="anchor">
                            <el-collapse-item title="属性" name="1">
                                <div>
                                    <div class="header">
                                        <span>标识</span>
                                    </div>
                                    <el-form :model="resGeneralForm" :rules="newResRules.rules1" ref="form1"
                                             label-position="right" label-width="250px">
                                        <el-form-item label="物资名称" prop="goodName" required>
                                            <el-input v-model="resGeneralForm.goodName"
                                                      placeholder="物资名称"></el-input>
                                        </el-form-item>
                                        <el-form-item label="身份识别码" prop="localId" required>
                                            <el-input v-model="resGeneralForm.localId" placeholder="身份识别码"></el-input>
                                        </el-form-item>
                                        <el-form-item label="物资类型">
                                            <el-ext-foldable :options="resTypeList" v-model="resGeneralForm.type"></el-ext-foldable>
                                        </el-form-item>
                                        <!-- el-form-item label="物资类型" prop="type" required>
                                            <el-select v-model="resGeneralForm.type" placeholder="物资类型">
                                                <el-option value="电脑整机">电脑整机</el-option>
                                                <el-option value="大型家电">大型家电</el-option>
                                                <el-option value="网络产品">网络产品</el-option>
                                                <el-option value="厨房电器">厨房电器</el-option>
                                                <el-option value="电脑配件">电脑配件</el-option>
                                                <el-option value="五金装饰">五金装饰</el-option>
                                                <el-option value="摄影摄像">摄影摄像</el-option>
                                                <el-option value="健康卫生">健康卫生</el-option>
                                                <el-option value="数码配件">数码配件</el-option>
                                                <el-option value="通信器材">通信器材</el-option>
                                                <el-option value="办公设备">办公设备</el-option>
                                                <el-option value="家具">家具</el-option>
                                                <el-option value="文具耗材">文具耗材</el-option>
                                                <el-option value="生活电器 ">生活电器</el-option>
                                                <el-option value="生活用品">生活用品</el-option>
                                                <el-option value="汽车用品">汽车用品</el-option>
                                                <el-option value="文体器材">文体器材</el-option>
                                                <el-option value="学习书籍">学习书籍</el-option>
                                                <el-option value="粮油食品">粮油食品</el-option>
                                                <el-option value="工程建材">工程建材</el-option>
                                                <el-option value="医疗卫生">医疗卫生</el-option>
                                                <el-option value="油品">油品</el-option>
                                                <el-option value="军队服装">军队服装</el-option>
                                                <el-option value="交通工具">交通工具</el-option>
                                                <el-option value="其他">其他</el-option>
                                            </el-select>
                                        </el-form-item -->
                                        <el-form-item label="关键字" prop="keywords">
                                            <el-input v-model="resGeneralForm.keywords" placeholder="关键字"></el-input>
                                        </el-form-item>
                                    </el-form>
                                </div>
                                <div>
                                    <div class="header">
                                        <span>特征</span>
                                    </div>
                                    <el-form label-position="right" label-width="250px" :model="resGeneralForm"
                                             :rules="newResRules.rules2" ref="form2">
                                        <el-form-item label="物资规格" prop="norms" required>
                                            <el-input v-model="resGeneralForm.norms" placeholder="物资规格"></el-input>
                                        </el-form-item>
                                        <el-form-item label="外观" prop="appearance" required>
                                            <el-input v-model="resGeneralForm.appearance" placeholder="外观"></el-input>
                                        </el-form-item>
                                        <el-form-item label="生产商名称" prop="producerName" required>
                                            <el-input v-model="resGeneralForm.producerName"
                                                      placeholder="生产商名称"></el-input>
                                        </el-form-item>
                                        <el-form-item label="生产日期" prop="produceTime">
                                            <el-date-picker v-model="resGeneralForm.produceTime" type="date"
                                                            placeholder="选择生产日期"
                                                            format="yyyy年MM月dd日"
                                                            value-format="yyyy-MM-dd"></el-date-picker>
                                        </el-form-item>
                                        <el-form-item label="失效日期" prop="validTime">
                                            <el-date-picker v-model="resGeneralForm.validTime" type="date"
                                                            placeholder="选择失效日期"
                                                            format="yyyy年MM月dd日"
                                                            value-format="yyyy-MM-dd"></el-date-picker>
                                        </el-form-item>
                                        <div class="sub-form">
                                            <div class="header">
                                                <span>环境特征</span>
                                            </div>
                                            <el-form label-position="right" label-width="250px" :model="resGeneralForm"
                                                     :rules="newResRules.rules3" ref="form3">
                                                <el-form-item label="安全条件" prop="safetyCondition" required>
                                                    <el-input v-model="resGeneralForm.safetyCondition"
                                                              placeholder="安全条件"></el-input>
                                                </el-form-item>
                                                <el-form-item label="运载尺寸" prop="carrierSize" required>
                                                    <el-input v-model="resGeneralForm.carrierSize"
                                                              placeholder="运载尺寸"></el-input>
                                                </el-form-item>
                                                <el-form-item label="温度条件" prop="temperature">
                                                    <el-input v-model="resGeneralForm.temperature"
                                                              placeholder="温度条件"></el-input>
                                                </el-form-item>
                                                <el-form-item label="湿度条件" prop="humidity">
                                                    <el-input v-model="resGeneralForm.humidity"
                                                              placeholder="湿度条件"></el-input>
                                                </el-form-item>
                                                <el-form-item label="其他条件" prop="otherCondition">
                                                    <el-input v-model="resGeneralForm.otherCondition"
                                                              placeholder="其他条件"></el-input>
                                                </el-form-item>
                                            </el-form>
                                        </div>
                                    </el-form>

                                </div>

                            </el-collapse-item>
                        </div>
                        <div id="Pos" class="anchor">
                            <el-collapse-item title="位置" name="2">
                                <div name="2">
                                    <div class="header">
                                        <span>绝对位置</span>
                                    </div>
                                    <el-form label-position="right" label-width="250px">
                                        <el-form-item label="经度">
                                            <el-input v-model="warehouseInfo.longitude" :disabled="true"></el-input>
                                        </el-form-item>
                                        <el-form-item label="纬度">
                                            <el-input v-model="warehouseInfo.latitude" :disabled="true"></el-input>
                                        </el-form-item>
                                    </el-form>
                                </div>
                                <div>
                                    <div class="header">
                                        <span>相对位置</span>
                                    </div>
                                    <el-form label-position="right" label-width="250px">
                                        <el-form-item label="所在仓库">
                                            <el-input v-model="warehouseInfo.warehouseName" :disabled="true"></el-input>
                                        </el-form-item>
                                    </el-form>
                                    <div class="sub-form">
                                        <div class="header">
                                            <span>行政位置</span>
                                        </div>
                                        <el-form label-position="right" label-width="250px">
                                            <el-form-item label="国家">
                                                <el-input v-model="warehouseInfo.country" :disabled="true"></el-input>
                                            </el-form-item>
                                            <el-form-item label="战区">
                                                <el-input v-model="warehouseInfo.area" :disabled="true"></el-input>
                                            </el-form-item>
                                            <el-form-item label="省/市/区">
                                                <el-cascader :options="areaData" v-model="selectedLocations"
                                                             size="large" :disabled="true"></el-cascader>
                                            </el-form-item>
                                            <el-form-item label="详细地址">
                                                <el-input v-model="warehouseInfo.detailLocation"
                                                          :disabled="true"></el-input>
                                            </el-form-item>
                                        </el-form>
                                    </div>
                                </div>
                            </el-collapse-item>
                        </div>
                        <div id="State" class="anchor">
                            <el-collapse-item title="状态" name="3" id="State">
                                <div class="header">
                                    <span>权属</span>
                                </div>
                                <el-form label-position="right" label-width="250px" :model="resGeneralForm"
                                         :rules="newResRules.rules4" ref="form4">
                                    <el-form-item label="所属部门" prop="department" required>
                                        <el-select placeholder="所属部门" v-model="resGeneralForm.department">
                                            <el-option value="陆军部001部队后勤保障中心">陆军部001部队后勤保障中心</el-option>
                                            <el-option value="海军部054部队后勤保障中心">海军部054部队后勤保障中心</el-option>
                                            <el-option value="空军部003部队后勤保障中心">空军部003部队后勤保障中心</el-option>
                                            <el-option value="火箭军部015部队后勤保障中心">火箭军部015部队后勤保障中心</el-option>
                                            <el-option value="战略支援部队总部后勤保障中心">战略支援部队总部后勤保障中心</el-option>
                                            <el-option value="陆军部028部队后勤保障中心">陆军部028部队后勤保障中心</el-option>
                                            <el-option value="DKY商厦集团货品部">DKY商厦集团货品部</el-option>
                                            <el-option value="XKY医院材料管理处">XKY医院材料管理处</el-option>
                                            <el-option value="HKWS集团产品部">HKWS集团产品部</el-option>
                                            <el-option value="JSKJ有限公司保障部">JSKJ有限公司保障部</el-option>
                                            <el-option value="HDDN厂货品部">HDDN厂货品部</el-option>
                                            <el-option value="SCDZ油品有限公司仓储部">SCDZ油品有限公司仓储部</el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="所属期限" prop="limitTime" required>
                                        <el-date-picker v-model="resGeneralForm.limitTime" type="date"
                                                        placeholder="选择所属期限"
                                                        format="yyyy年MM月dd日"
                                                        value-format="yyyy-MM-dd"></el-date-picker>
                                    </el-form-item>
                                    <el-form-item label="负责人员" prop="official" required>
                                        <el-input placeholder="负责人员" v-model="resGeneralForm.official"></el-input>
                                    </el-form-item>
                                    <el-form-item label="联系电话" prop="phone" required>
                                        <el-input placeholder="联系电话" v-model="resGeneralForm.phone"></el-input>
                                    </el-form-item>
                                </el-form>
                                <div>
                                    <div class="header">
                                        <span>过程</span>
                                    </div>
                                    <el-form label-position="right" label-width="250px" :model="resGeneralForm"
                                             :rules="newResRules.rules5" ref="form5">
                                        <el-form-item label="管理" prop="isManaged" required>
                                            <el-select v-model="resGeneralForm.isManaged" placeholder="请选择是否在监控中">
                                                <el-option label="在监控中" :value="1">在监控中</el-option>
                                                <el-option label="不在监控中" :value="0">不在监控中</el-option>
                                            </el-select>
                                        </el-form-item>
                                    </el-form>
                                    <div class="sub-form">
                                        <div class="header">
                                            <span>状态&途径</span>
                                        </div>

                                        <el-form label-position="right" label-width="250px" :model="resGeneralForm"
                                                 :rules="newResRules.rules6" ref="form6">
                                            <el-form-item label="状态名称" prop="stateId" required>
                                                <el-select v-model="resGeneralForm.stateId" placeholder="请选择状态名称">
                                                    <el-option label="占用" :value="1">占用</el-option>
                                                    <el-option label="调配" :value="2">调配</el-option>
                                                    <el-option label="使用" :value="3">使用</el-option>
                                                    <el-option label="空闲" :value="4">空闲</el-option>
                                                </el-select>
                                            </el-form-item>
                                            <el-form-item label="状态类别" prop="stateType" required>
                                                <el-select v-model="resGeneralForm.stateType" placeholder="请选择状态类别">
                                                    <el-option label="正常" :value="1">正常</el-option>
                                                    <el-option label="故障" :value="0">故障</el-option>
                                                </el-select>
                                            </el-form-item>
                                            <el-form-item label="状态值" prop="stateValue" required>
                                                <el-input placeholder="0%~100%"
                                                          v-model="resGeneralForm.stateValue"></el-input>
                                            </el-form-item>
                                        </el-form>
                                    </div>
                                </div>
                            </el-collapse-item>
                        </div>
                        <div id="Cap" class="anchor">
                            <el-collapse-item title="能力" name="4" id="Cap">
                                <div v-for="useCap in useCapabilityList" name="4">
                                    <div class="header">
                                <span>使用能力
                                <div class="adel">
                                    <el-button type="primary" size="mini"
                                               @click="handleAddUseCapability">+ 添加</el-button>
                                    <el-button type="danger" size="mini"
                                               @click="()=>{handleDeleteUseCapability(useCapabilityList.indexOf(useCap))}">- 删除</el-button>
                                </div>
                                </span>
                                    </div>
                                    <el-form label-position="right" label-width="250px" :model="useCap"
                                             :rules="newResRules.rules7"
                                             :ref="'form'+(7+useCapabilityList.indexOf(useCap))">
                                        <el-form-item label="能力类型" prop="smallType" required>
                                            <el-select placeholder="请选择能力类型" v-model="useCap.smallType">
                                                <el-option value="补给">补给</el-option>
                                                <el-option value="维修">维修</el-option>
                                                <el-option value="土木">土木</el-option>
                                                <el-option value="卫勤">卫勤</el-option>
                                                <el-option value="其他">其他</el-option>
                                            </el-select>
                                        </el-form-item>
                                        <el-form-item label="能力描述" prop="detail" required>
                                            <el-input placeholder="能力描述" v-model="useCap.detail"></el-input>
                                        </el-form-item>
                                    </el-form>
                                </div>
                                <div v-for="garCap in guaranteeCapabilityList">
                                    <div class="header">
                                <span>保障能力
                                <div class="adel">
                                    <el-button type="primary" size="mini"
                                               @click="handleAddGuaranteeCapability">+ 添加</el-button>
                                    <el-button type="danger" size="mini"
                                               @click="()=>{handleDeleteGuaranteeCapability(guaranteeCapabilityList.indexOf(garCap))}">- 删除</el-button>
                                </div>
                                </span>
                                    </div>
                                    <el-form label-position="right" label-width="250px" :model="garCap"
                                             :rules="newResRules.rules7"
                                             :ref="'form'+(7+useCapabilityList.length+guaranteeCapabilityList.indexOf(garCap))">
                                        <el-form-item label="能力类型" prop="smallType" required>
                                            <el-select placeholder="请选择能力类型" v-model="garCap.smallType">
                                                <el-option value="采购">采购</el-option>
                                                <el-option value="配送">配送</el-option>
                                                <el-option value="维持">维持</el-option>
                                                <el-option value="处理">处理</el-option>
                                                <el-option value="其他">其他</el-option>
                                            </el-select>
                                        </el-form-item>
                                        <el-form-item label="能力描述" prop="detail" required>
                                            <el-input placeholder="能力描述" v-model="garCap.detail"></el-input>
                                        </el-form-item>
                                    </el-form>
                                </div>
                            </el-collapse-item>
                        </div>
                    </el-collapse>
                    <p style="text-align: right">
                        <el-button type="primary" @click="commitRegister">保存并返回</el-button>
                        <el-button @click="cancelRegister">放弃并返回</el-button>
                    </p>
                </el-main>
            </el-container>
        </el-container>
    </div>
    <div v-if="state===3" id="box3">
        <!--startprint-->
        <p id="form-top">
            <span><b>入库单号:</b>{{importInfo.inboundNum}}</span>
            <span><b>入库类别:</b>{{['非正常入库','正常入库'][importInfo.type]}}</span>
            <span><b>供应商:</b>{{importInfo.supplier}}</span>
            <span><b>建单人:</b>{{importInfo.founder}}</span>
            <span><b>建单日期:</b>{{(()=>{
                var da=new Date();
                var [year,month,date]=[da.getFullYear(),da.getMonth()+1,da.getDate()];
                return year+'年'+month+'月'+date+'日';
                })()}}</span>
        </p>
        <table class="grid">
            <tr>
                <th>序号</th>
                <th>物资名称</th>
                <th>身份识别码</th>
                <th>数量</th>
                <th>单位</th>
                <th>存放库位</th>
                <th>负责人</th>
                <th>联系电话</th>
                <th>备注</th>
            </tr>
            <tr v-for="data in toPrint">
                <td v-for="key in Object.keys(data)">{{data[key]}}</td>
            </tr>
        </table>
        <!--endprint-->
        <p class="noprint">
            <el-button type="primary" @click="performPrint">打印</el-button>
            <el-button @click="()=>{state=1;}">返回</el-button>
        </p>
    </div>
</div>
</body>
<!-- 这是 JS 代码，一定要放在 <body> 后面 -->
<script src="lib/vue.js"></script>
<script src="lib/eleme-index.js"></script>
<script src="res/dependencies.js"></script>
<script>
    //------------------------------------------------------------------
    var post = require('/mods/backend');
    var ChinaAreaData = require("element-china-area-data").regionData;
    var importObj = {};
    var TTC = require("element-china-area-data").TextToCode;
    const ElExtFoldable = require('/comps/el-ext-foldable');

    //------------------------------------------------------------------
    function generalSingle() {
        this.unit = "";
        this.amount = "";
        this.warehouseRepository = "";
        this.charity = "";
        this.phone = "";
    }

    //------------------------------------------------------------------
    var warehouseChoice = [];
    // var powerGeneralList = [new powerGeneral()];
    var useCapGeneralList = [new capGeneral()];
    var garCapGeneralList = [new capGeneral()];
    var warehouseInfo = {};
    var selectedLocations = [];

    function capGeneral() {
        this.smallType = "";
        this.detail = "";
    }

    function resGeneral() {
        this.goodName = undefined;
        this.localId = undefined;
        this.type = undefined;
        this.keywords = undefined;
        this.norms = undefined;
        this.appearance = undefined;
        this.producerName = undefined;
        this.produceTime = undefined;
        this.validTime = undefined;
        this.safetyCondition = undefined;
        this.carrierSize = undefined;
        this.temperature = undefined;
        this.humidity = undefined;
        this.otherCondition = undefined;
        this.longitude = undefined;
        this.latitude = undefined;
        this.altitude = undefined;
        this.warehouseId = undefined;
        this.country = undefined;
        this.area = undefined;
        this.province = undefined;
        this.city = undefined;
        this.county = undefined;
        this.detailLocation = undefined;
        this.department = undefined;
        this.limitTime = undefined;
        this.official = undefined;
        this.phone = undefined;
        this.stateId = undefined;
        this.stateType = undefined;
        this.stateValue = undefined;
        this.isManaged = undefined;
    }

    // function powerGeneral() {
    //     this.department = "";
    //     this.limitTime = "";
    //     this.official = "";
    //     this.phone = "";
    // }


    var app = new Vue({
        el: '#app',
        data: function () {
            return {
                state: 1,
                currentIndex: null,
                addFormVisible: false,
                importInfo: {
                    //入库单号
                    inboundNum: (() => {
                        let da = new Date();
                        let postfix = String(Date.parse(da)).slice(4, 10);
                        let [year, month, date] = [
                            da.getFullYear(),
                            da.getMonth() + 1 < 10 ? '0' + (da.getMonth() + 1) : da.getMonth() + 1,
                            da.getDate() < 10 ? '0' + da.getDate() : da.getDate()
                        ];
                        return [year, month, date].join('') + postfix;
                    })(),
                    //建单人
                    founder: "",
                    //建单日期
                    createdDate: "",
                    //供应商
                    supplier: "",
                    //入库类别
                    type: ""
                },
                singleResAddInfo: {
                    goodId: "",
                    unit: "",
                    amount: "",
                    warehouseRepository: "",
                    charity: "",
                    phone: "",
                    remark: "",
                    canView: false
                },
                singleResEditInfo: {
                    goodId: "",
                    unit: "",
                    amount: "",
                    warehouseRepository: "",
                    charity: "",
                    phone: "",
                    remark: "",
                    canView: false
                },
                resInfo: [],
                storedDetailResInfo: [],
                detailDialogVisible: false,
                editFormVisible: false,
                detailToDisplay: [],
                smallFormRule: {
                    amount: [
                        {required: true, message: '请输入数量'}
                    ],
                    unit: [
                        {required: true, message: '请输入单位'}
                    ],
                    warehouseRepository: [
                        {required: true, message: '请输入存放库位'}
                    ],
                    charity: [
                        {required: true, message: '请输入负责人'}
                    ],
                    phone: [
                        {required: true, message: '请输入联系电话'}
                    ],
                    remark: [
                        {required: true, message: '请输入备注,若没有请输入无'}
                    ]
                },
                headerRules: {
                    rules1: {
                        inboundNum: [
                            {required: true, message: '请填写入库单号'}
                        ],
                        founder: [
                            {required: true, message: '请填写建单人'}
                        ]
                    },
                    rules3: {
                        supplier: [
                            {required: true, message: '请填写供应商'}
                        ],
                        type: [
                            {required: true, message: '请选择入库类别'}
                        ]
                    }

                },

                //------------------------------

                warehouseInfo: warehouseInfo,
                warehouseChoiceMsg: "请先选择国家和省市",
                warehouseChoiceDisable: true,
                menu: [{val: '属性', id: 'Attr'}, {val: '位置', id: 'Pos'}, {val: '状态', id: 'State'}, {
                    val: '能力',
                    id: 'Cap'
                }],
                areaData: ChinaAreaData,
                warehouseChoice: warehouseChoice,
                selectedLocations: selectedLocations,
                activeNames: ['1', '2', '3', '4'],
                // powerBelongList: powerGeneralList,
                useCapabilityList: useCapGeneralList,
                guaranteeCapabilityList: garCapGeneralList,
                resTypeList: [
                    '电脑整机', '大型家电', '网络产品', '厨房电器',
                    '电脑配件', '五金装饰', '摄影摄像', '健康卫生',
                    '数码配件', '通信器材', '办公设备', '家具',
                    '文具耗材', '生活电器', '生活用品', '汽车用品',
                    '文体器材', '学习书籍', '粮油食品', '工程建材',
                    '医疗卫生', '油品', '军队服装', '交通工具', '其他'
                ],
                resGeneralForm: {
                    goodName: undefined,
                    localId: undefined,
                    type: undefined,
                    keywords: undefined,
                    norms: undefined,
                    appearance: undefined,
                    producerName: undefined,
                    produceTime: undefined,
                    validTime: undefined,
                    safetyCondition: undefined,
                    carrierSize: undefined,
                    temperature: undefined,
                    humidity: undefined,
                    otherCondition: undefined,
                    longitude: undefined,
                    latitude: undefined,
                    altitude: undefined,
                    warehouseId: undefined,
                    country: undefined,
                    area: undefined,
                    province: undefined,
                    city: undefined,
                    county: undefined,
                    detailLocation: undefined,
                    department: undefined,
                    limitTime: undefined,
                    official: undefined,
                    phone: undefined,
                    stateId: undefined,
                    stateType: undefined,
                    stateValue: undefined,
                    isManaged: undefined,
                },
                translation: {
                    goodName: "物资名称",
                    localId: "身份识别码",
                    type: "物资类型",
                    keywords: "关键字",
                    norms: "物资规格",
                    appearance: "外观",
                    producerName: "生产商名称",
                    produceTime: "生产日期",
                    validTime: "失效日期",
                    safetyCondition: "安全条件",
                    carrierSize: "运载尺寸",
                    temperature: "温度条件",
                    humidity: "湿度条件",
                    otherCondition: "其他条件",
                    longitude: "经度",
                    latitude: "纬度",
                    altitude: "海拔",
                    warehouseId: "所在仓库ID",
                    country: "国家",
                    area: "战区",
                    province: "省份",
                    city: "城市",
                    county: "区县",
                    detailLocation: "详细地址",
                    department: "所属部门",
                    limitTime: "所属期限",
                    official: "负责人员",
                    phone: "联系电话",
                    stateId: "状态名称",
                    stateType: "状态类别",
                    stateValue: "状态值",
                    isManaged: "管理",
                    useAbility: "使用能力",
                    garAbility: "保障能力",
                },
                newResRules: {
                    rules1: {
                        goodName: [
                            {required: true, message: '请输入物资名称'}
                        ],
                        localId: [
                            {required: true, message: '请输入身份识别码'}
                        ],
                        type: [
                            {required: true, message: '请选择物资类型'}
                        ]
                    },
                    rules2: {
                        norms: [
                            {required: true, message: '请输入物资规格'}
                        ],
                        appearance: [
                            {required: true, message: '请输入外观'}
                        ],
                        producerName: [
                            {required: true, message: '请输入生产商名称'}
                        ]
                    },
                    rules3: {
                        safetyCondition: [
                            {required: true, message: '请输入安全条件'}
                        ],
                        carrierSize: [
                            {required: true, message: '请输入运载尺寸'}
                        ]
                    },
                    rules4: {
                        department: [
                            {required: true, message: '请选择所属部门'}
                        ],
                        limitTime: [
                            {required: true, message: '请选择所属期限'}
                        ],
                        official: [
                            {required: true, message: '请输入负责人员'}
                        ],
                        phone: [
                            {required: true, message: '请输入联系电话'}
                        ]
                    },
                    rules5: {
                        isManaged: [
                            {required: true, message: '请选择是否受监管'}
                        ]
                    },
                    rules6: {
                        stateId: [
                            {required: true, message: '请选择状态名称'}
                        ],
                        stateType: [
                            {required: true, message: '请选择状态类别'}
                        ],
                        stateValue: [
                            {required: true, message: '请输入状态值'},
                            {pattern: /\d+%/, message: '请以百分数形式输入(0%~100%)'}
                        ]
                    },
                    rules7: {
                        smallType: [
                            {required: true, message: '请选择能力类型'}
                        ],
                        detail: [
                            {required: true, message: '请输入能力描述'}
                        ]
                    }

                },
                //-------------------------------------------------------------
                toPrint: [],
                printButtonVisible: true
            }
        },
        mounted: function () {
            post('/depot/get_houselocate', {}, (data, err) => {
                if (err) {
                    console.log(err);
                    return;
                }
                Object.assign(warehouseInfo, data);
                app.selectedLocations.push(TTC[data.province].code, TTC[data.province][data.city === data.province ? '市辖区' : data.city].code, TTC[data.province][data.city === data.province ? '市辖区' : data.city][data.county].code);
            })
        },
        methods: {
            indexMethod(index) {
                return index + 1;
            },
            handleAdd() {
                app.singleResAddInfo = {};
                app.addFormVisible = true;
            },
            performAdd() {
                app.$refs['dialogAddForm'].validate((valid) => {
                    if (valid) {
                        app.addFormVisible = false;
                        app.resInfo.push(app.singleResAddInfo);
                    } else {
                        app.$message.error('信息填写错误,请重新填写');
                        return false;
                    }
                })
            },
            performDelete(index, rows) {
                rows.splice(index, 1);
            },
            performEdit(row) {
                app.$refs['dialogEditForm'].validate((valid) => {
                    if (valid) {
                        app.editFormVisible = false;
                        app.resInfo[app.resInfo.indexOf(row)] = {...app.singleResEditInfo};
                        app.singleResEditInfo = new generalSingle();
                    } else {
                        app.$message.error('信息填写错误，请重新填写');
                        return false;
                    }
                })

            },
            handleEdit(index, rows) {
                app.singleResEditInfo = {...rows[index]};
                app.editFormVisible = true;
            },
            save() {
                if (app.resInfo.length === 0) {
                    app.$message.error('未填写货品信息');
                    return;
                }
                app.$refs['upperForm'].validate((valid) => {
                    console.log(valid);
                    if (!valid) {
                        app.$message.error('表单信息填写错误,请重新填写');
                        return false;
                    }
                });
                app.$refs['downForm'].validate((valid) => {
                    console.log(valid);
                    if (!valid) {
                        app.$message.error('表单信息填写错误,请重新填写');
                        return false;
                    } else {
                        var toPost = {};
                        Object.assign(toPost, app.importInfo);
                        for (let i in app.resInfo) {
                            toPost['goodLocalId'] = app.resInfo[i].goodLocalId;
                            toPost['goodName'] = app.resInfo[i].goodName;
                            toPost['warehouseId'] = app.resInfo[i].warehouseId;
                            Object.assign(toPost, app.resInfo[i]);
                            delete toPost.goodId;
                            delete toPost.canView;
                            delete toPost.createdDate;
                            toPost['amount'] = Number(toPost['amount']);
                            toPost['type'] = String(toPost['type']);
                            for (let i in toPost) {
                                if (!toPost[i]) {
                                    delete toPost[i];
                                }
                            }
                            ((e) => {
                                post('/depot/add_newinbound', {...toPost}, (data, err) => {
                                    if (err) {
                                        app.$message.error('未填写货品信息');
                                        return;
                                    }
                                    app.$message({type:'success',message:'保存成功!'});
                                })
                            })(i)
                        }
                    }
                });
            },
            print() {
                if (app.resInfo.length === 0) {
                    app.$message.error('未填写货品信息');
                    return;
                }
                app.$refs['upperForm'].validate((valid) => {
                    console.log(valid);
                    if (!valid) {
                        app.$message.error('表单信息填写错误,请重新填写');
                        return false;
                    }
                });
                app.$refs['downForm'].validate((valid) => {
                    console.log(valid);
                    if (!valid) {
                        app.$message.error('表单信息填写错误,请重新填写');
                        return false;
                    } else {
                        app.toPrint = [];
                        var obj = {
                            index: 1,
                            goodName: "",
                            goodLocalId: "",
                            amount: "",
                            unit: "",
                            warehouseRepository: "",
                            charity: "",
                            phone: "",
                            remark: ""
                        };
                        for (let i in app.resInfo) {
                            Object.assign(obj, app.resInfo[i]);
                            obj.index = parseInt(i) + 1;
                            delete obj.goodId;
                            delete obj.warehouseId;
                            delete obj.canView;
                            app.toPrint.push({...obj});
                        }
                        app.state = 3;
                    }
                });

            },
            performPrint() {
                window.print();
            },
            createRes(index) {
                app.resGeneralForm = new resGeneral();
                app.useCapabilityList = [new capGeneral()];
                app.guaranteeCapabilityList = [new capGeneral()];
                app.state = 2;
                importObj.resIndex = index;
            },
            viewResDetail(index) {
                app.detailDialogVisible = true;
                var data = app.storedDetailResInfo[index];
                var obj = {key: "", val: ""};
                for (var i in data) {
                    if (i !== 'useAbility' && i !== 'garAbility') {
                        obj['val'] = data[i];
                    } else if (i === 'useAbility') {
                        let j = 0;
                        obj['val'] = "";
                        while (data[i][j]) {
                            obj['val'] += String(data[i][j].smallType) + ': ' + String(data[i][j].detail) + '\n';
                            j++;
                        }
                    } else if (i === 'garAbility') {
                        let j = 0;
                        obj['val'] = "";
                        while (data[i][j]) {
                            obj['val'] += String(data[i][j].smallType) + ': ' + String(data[i][j].detail) + '\n';
                            j++;
                        }
                    } else {
                        continue;
                    }
                    obj['key'] = app.translation[i];
                    if (obj['val']) {
                        app.detailToDisplay.push({...obj});
                    }
                }
            },
            //------------------------------------------------------

            handleLocationChange() {
                while (warehouseChoice[0] !== undefined) {
                    warehouseChoice.pop();
                }
                var country = app.resGeneralForm.country;
                var [province, city, county] = [...app.selectedLocations];
                [app.resGeneralForm['province'], app.resGeneralForm['city'], app.resGeneralForm['county']] = [...app.selectedLocations];
                post('/common/allwarehouse', {
                    country: country,
                    province: province,
                    city: city
                }, (data) => {
                    var isChange = true;
                    for (var warehouse of data) {
                        warehouseChoice.push(warehouse);
                        if (app.resGeneralForm.warehouseId === warehouse.warehouseId) {
                            isChange = false;
                        }
                    }
                    if (isChange) {
                        app.resGeneralForm.warehouseId = "";
                    }
                });
            },
            handleCountryChange() {
                while (warehouseChoice[0] !== undefined) {
                    warehouseChoice.pop();
                }
                var country = app.resGeneralForm.country;
                var [province, city, county] = [...app.selectedLocations];
                [app.resGeneralForm['province'], app.resGeneralForm['city'], app.resGeneralForm['county']] = [...app.selectedLocations];
                post('/common/allwarehouse', {
                    country: country,
                    province: province,
                    city: city
                }, (data) => {
                    var isChange = true;
                    for (var warehouse of data) {
                        warehouseChoice.push(warehouse);
                        if (app.resGeneralForm.warehouseId === warehouse.warehouseId) {
                            isChange = false;
                        }
                    }
                    if (isChange) {
                        app.resGeneralForm.warehouseId = "";
                    }
                });
            },
            handleCollapse(val) {
                app.activeNames = val;
            },
            // handleAddPowerBelong() {
            //     app.$message({
            //         type: 'warning',
            //         message: '这个功能暂时不要'
            //     })
            //     //app.powerBelongList.push({department: "", limitTime: "", official: "", phone: ""});
            // },
            handleAddUseCapability() {
                app.useCapabilityList.push({smallType: "", detail: ""});
            },
            handleAddGuaranteeCapability() {
                app.guaranteeCapabilityList.push({smallType: "", detail: ""});
            },
            handleDeletePowerBelong(index) {
                if (app.powerBelongList.length <= 1) {
                    app.$message.error('至少需要保留一个权属');
                    return;
                }
                app.powerBelongList.splice(index, 1);
            },
            handleDeleteUseCapability(index) {
                if (app.useCapabilityList.length <= 1) {
                    app.$message.error('至少需要保留一个使用能力');
                    return;
                }
                app.useCapabilityList.splice(index, 1);
            },
            handleDeleteGuaranteeCapability(index) {
                if (app.guaranteeCapabilityList.length <= 1) {
                    app.$message.error('至少需要保留一个保障能力');
                    return;
                }
                app.guaranteeCapabilityList.splice(index, 1);
            },
            commitRegister() {
                let promise = new Promise((resolve, reject) => {
                    var [validNum, totalNum] = [0, 0];
                    for (var formName in app.$refs) {
                        ((p) => {
                            if (formName.match(/form\d+/)) {
                                (Number(formName.slice(-1)) >= 7 ? p[0] : p).validate((valid) => {
                                    totalNum++;
                                    if (valid) {
                                        validNum++;
                                    }
                                    if (totalNum !== validNum) {
                                        app.$message.error('信息填写错误，请重新填写');
                                        reject();
                                        return false;
                                    }
                                })
                            }
                        })(app.$refs[formName])
                    }
                    resolve();
                })
                promise.then(() => {
                    app.$confirm('确定信息填写无误？提交后将无法修改').then(() => {
                        let obj = {};
                        obj = app.resGeneralForm;
                        let uA = [];
                        let gA = [];
                        for (let useAbility of app.useCapabilityList) {
                            uA.push(useAbility);
                        }
                        for (let garAbility of app.guaranteeCapabilityList) {
                            gA.push(garAbility);
                        }
                        obj.useAbility = uA;
                        obj.garAbility = gA;
                        app.storedDetailResInfo.push(obj);
                        post('/depot/reg_newgood', app.resGeneralForm, (data, err) => {
                            if (err) {
                                if (err.id === 5021) {
                                    app.$message.error('身份识别码重复');
                                    return;
                                }
                            }
                            var goodId = data.goodId;
                            console.log(data);
                            importObj.goodId = goodId;
                            app.resInfo[importObj.resIndex].goodLocalId = data.goodLocalId;
                            app.resInfo[importObj.resIndex].goodId = importObj.goodId;
                            app.resInfo[importObj.resIndex].goodName = data.goodName;
                            app.resInfo[importObj.resIndex].warehouseId = data.warehouseId;
                            app.resInfo[importObj.resIndex].canView = true;
                            app.state = 1;
                            app.editFormVisible = true;
                            app.editFormVisible = false;
                            for (let useAbility of app.useCapabilityList) {
                                ((p) => {
                                    post('/depot/add_newability', {
                                        goodId: goodId,
                                        bigType: "使用能力",
                                        smallType: p.smallType,
                                        detail: p.detail
                                    }, (data, err) => {
                                        if (err) {
                                            app.$message.error(err.msg);
                                            console.log(err);
                                            return;
                                        }
                                    })
                                })(useAbility);
                            }
                            for (let garAbility of app.guaranteeCapabilityList) {
                                ((p) => {
                                    post('/depot/add_newability', {
                                        goodId: goodId,
                                        bigType: "保障能力",
                                        smallType: p.smallType,
                                        detail: p.detail
                                    }, (data, err) => {
                                        if (err) {
                                            console.log(err);
                                            return;
                                        }
                                    })
                                })(garAbility);
                            }
                            app.$message({
                                type: 'success',
                                message: '新物资注册成功'
                            });
                        });

                    })

                })
            },
            cancelRegister() {
                app.state = 1;
            }
        },
        components: {
            ElExtFoldable: ElExtFoldable
        }
    });
</script>
</html>
